<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Habbt - Your System for Better</title>
  <link rel="preload" href="enhanced-integration-system.js" as="script">
  <link rel="preload" href="meals-tab.js" as="script">
  <link rel="preload" href="meal-planning.js" as="script">
  <link rel="preload" href="grocery-delivery.js" as="script">
  <link rel="preload" href="pantry-tab.js" as="script">
  <link rel="preload" href="weight-journey.js" as="script">
  <script src="profile-tab.js"></script>
  <link rel="preload" href="wearables-tab.js" as="script">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    .text-gradient {
      background: linear-gradient(to right, #2563eb, #0d9488);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .bg-gradient-blue-teal {
      background: linear-gradient(to right, #2563eb, #1d4ed8, #0d9488);
    }
    .bg-gradient-card {
      background: linear-gradient(135deg, #dbeafe, #bfdbfe, #a7f3d0);
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="unified-data-manager.js"></script>
  <script src="enhanced-integration-system.js"></script>
  <script src="meals-tab.js"></script>
  <script src="pantry-tab.js"></script>
  <script src="weight-journey.js"></script>
  <script src="meal-planning.js"></script>
  <script src="grocery-delivery.js"></script>
  <script src="analytics-tab.js"></script>
  <script src="wearables-tab.js"></script>
  <script src="journal-tab.js"></script>
  <script>
    const { useState, useEffect, useMemo, createContext, useContext } = React;
    const { createElement: e } = React;

    // Simple App (No Authentication Required)
    function HabbtApp() {
      const [currentView, setCurrentView] = useState('profile');
      const [userDisplayName, setUserDisplayName] = useState('');

      // Load user's display name from localStorage only
      useEffect(() => {
        try {
          const localProfile = localStorage.getItem('habbt_profile_data');
          if (localProfile) {
            const parsed = JSON.parse(localProfile);
            if (parsed.personal?.name) {
              setUserDisplayName(parsed.personal.name);
              return;
            }
          }
          // Default name
          setUserDisplayName('User');
        } catch (error) {
          console.warn('Could not load user name:', error);
          setUserDisplayName('User');
        }
      }, []);

      // Your existing state and functionality (Firebase-free)
      const [userProfile, setUserProfile] = useState({
        name: '',
        age: '',
        weight: '',
        height: '',
        gender: 'male',
        activityLevel: 'moderate',
        goal: 'fat_loss',
        dietaryRestrictions: [],
        allergies: [],
        healthConcerns: [],
        antiBloutPreference: false,
        foodsILove: [],
        foodsIAvoid: [],
        cuisinePreferences: []
      });
      const [goals, setGoals] = useState({});
      const [meals, setMeals] = useState([]);

      // Simple localStorage (no cloud sync)
      const simpleLocalStorage = {
        setItem: (key, value) => {
          const newKey = key.replace('fueliq_', 'habbt_');
          localStorage.setItem(newKey, value);
        },
        getItem: (key) => {
          const newKey = key.replace('fueliq_', 'habbt_');
          return localStorage.getItem(newKey);
        },
        removeItem: (key) => {
          const newKey = key.replace('fueliq_', 'habbt_');
          return localStorage.removeItem(newKey);
        }
      };

      // Make simple localStorage available globally
      useEffect(() => {
        window.enhancedLocalStorage = simpleLocalStorage;
      }, []);

      // Navigation setup
      useEffect(() => {
        const handleNavigate = (e) => {
          console.log('🚀 Navigation event received:', e.detail.tab);
          setCurrentView(e.detail.tab);
        };
        
        window.addEventListener('habbt-navigate', handleNavigate);
        window.setCurrentView = setCurrentView;
        
        return () => {
          window.removeEventListener('habbt-navigate', handleNavigate);
          window.setCurrentView = null;
        };
      }, [setCurrentView]);

      useEffect(() => {
        window.setCurrentView = setCurrentView;
        console.log('✅ Navigation exposed globally');
        
        return () => {
          window.setCurrentView = null;
        };
      }, [setCurrentView]);

      // Enhanced container cleanup function
      const clearContainer = (containerId) => {
        const container = document.getElementById(containerId);
        if (container) {
          try {
            if (window.ReactDOM && window.ReactDOM.unmountComponentAtNode) {
              window.ReactDOM.unmountComponentAtNode(container);
            }
            container.innerHTML = '';
            container.style.cssText = '';
            container.className = 'meals-tab-content';
            console.log(`✅ Container ${containerId} cleared successfully`);
          } catch (e) {
            console.warn(`⚠️ Error clearing container ${containerId}:`, e);
            container.innerHTML = '';
          }
        }
      };

      // Enhanced cleanup function
      const forceCleanup = () => {
        ['meals-container', 'journey-container', 'pantry-container', 'planning-container', 'grocery-container', 'analytics-container', 'wearables-container', 'journal-container'].forEach(id => {
          clearContainer(id);
        });
        
        if (window.HabbtMeals && window.HabbtMeals.cleanup) {
          window.HabbtMeals.cleanup();
        }
        if (window.HabbtWeightJourney && window.HabbtWeightJourney.cleanup) {
          window.HabbtWeightJourney.cleanup();
        }
        if (window.HabbtPantry && window.HabbtPantry.cleanup) {
          window.HabbtPantry.cleanup();
        }
        if (window.HabbtMealPlanning && window.HabbtMealPlanning.cleanup) {
          window.HabbtMealPlanning.cleanup();
        }
        if (window.HabbtGroceryDelivery && window.HabbtGroceryDelivery.cleanup) {
          window.HabbtGroceryDelivery.cleanup();
        }
        if (window.HabbtAnalytics && window.HabbtAnalytics.cleanup) {
          window.HabbtAnalytics.cleanup();
        }
        if (window.HabbtWearables && window.HabbtWearables.cleanup) {
          window.HabbtWearables.cleanup();
        }
        if (window.HabbtJournal && window.HabbtJournal.cleanup) {
          window.HabbtJournal.cleanup();
        }
      };

      // Calculate TDEE and macro goals
      const calculateGoals = (profile) => {
        const { age, weight, height, gender, activityLevel, goal } = profile;
        
        if (!age || !weight || !height) return {};
        
        const weightKg = weight / 2.205;
        
        let bmr;
        if (gender === 'male') {
          bmr = 10 * weightKg + 6.25 * (height * 2.54) - 5 * age + 5;
        } else {
          bmr = 10 * weightKg + 6.25 * (height * 2.54) - 5 * age - 161;
        }
        
        const activityMultipliers = {
          sedentary: 1.2,
          light: 1.375,
          moderate: 1.55,
          active: 1.725,
          very_active: 1.9
        };
        
        const tdee = bmr * activityMultipliers[activityLevel];
        
        const goalAdjustments = {
          fat_loss: -500,
          muscle_gain: 300,
          maintenance: 0,
          recomp: -200
        };
        
        const targetCalories = tdee + goalAdjustments[goal];
        
        const proteinPerKg = goal === 'muscle_gain' ? 2.2 : goal === 'fat_loss' ? 2.0 : 1.8;
        const proteinGrams = (weightKg * proteinPerKg);
        const proteinCalories = proteinGrams * 4;
        
        const fatPercentage = goal === 'fat_loss' ? 0.25 : 0.30;
        const fatCalories = targetCalories * fatPercentage;
        const fatGrams = fatCalories / 9;
        
        const carbCalories = targetCalories - proteinCalories - fatCalories;
        const carbGrams = carbCalories / 4;
        
        return {
          calories: Math.round(targetCalories),
          protein: Math.round(proteinGrams),
          carbs: Math.round(carbGrams),
          fat: Math.round(fatGrams),
          water: Math.round(weight * 0.67)
        };
      };

      // Load saved user profile
      useEffect(() => {
        if (currentView === 'setup') {
          console.log('🔄 Setup page activated - loading saved data...');
          
          try {
            const savedProfile = localStorage.getItem('habbt_user_profile');
            if (savedProfile) {
              const parsedProfile = JSON.parse(savedProfile);
              console.log('✅ Loaded profile from localStorage:', parsedProfile);
              setUserProfile(parsedProfile);
            } else {
              console.log('ℹ️ No saved profile found - showing empty form');
            }
          } catch (e) {
            console.warn('❌ Error loading saved data:', e);
          }
        }
      }, [currentView]);

      // Calculate goals when user profile changes
      useEffect(() => {
        if (userProfile.age && userProfile.weight && userProfile.height) {
          setGoals(calculateGoals(userProfile));
        }
      }, [userProfile]);

      // Enhanced cleanup on view change
      useEffect(() => {
        forceCleanup();
      }, [currentView]);

      // Goals sync for meals tab
      useEffect(() => {
        if (currentView === 'meals') {
          let userGoalsData;
          
          if (window.HabbtDataManager) {
            const goals = window.HabbtDataManager.getGoals();
            userGoalsData = {
              dailyCalories: goals.calories,
              calories: goals.calories,
              protein: goals.protein,
              carbs: goals.carbs,
              fat: goals.fat
            };
          } else if (goals.calories) {
            userGoalsData = {
              dailyCalories: goals.calories,
              calories: goals.calories,
              protein: goals.protein,
              carbs: goals.carbs,
              fat: goals.fat
            };
          }
          
          if (userGoalsData) {
            try {
              localStorage.setItem('habbt_user_goals', JSON.stringify(userGoalsData));
              console.log('✅ Goals synchronized for meals tab:', userGoalsData);
            } catch (e) {
              console.warn('localStorage not available:', e);
            }
          }
        }
      }, [currentView, goals]);

      // Tab rendering useEffects
      useEffect(() => {
        if (currentView === 'meals') {
          clearContainer('meals-container');
          
          if (window.HabbtDataManager) {
            const goals = window.HabbtDataManager.getGoals();
            localStorage.setItem('habbt_user_goals', JSON.stringify(goals));
            console.log('✅ Goals synchronized for meals tab (Habbt)');
          }
          
          let retryCount = 0;
          const maxRetries = 3;
          
          const tryRenderMeals = () => {
            if (window.HabbtMeals && window.HabbtMeals.renderMealsTab) {
              try {
                window.HabbtMeals.renderMealsTab('meals-container');
                console.log('✅ Meals tab rendered successfully (Habbt)');
              } catch (error) {
                console.error('Error rendering meals tab (Habbt):', error);
              }
            } else if (window.FuelIQMeals && window.FuelIQMeals.renderMealsTab) {
              try {
                window.FuelIQMeals.renderMealsTab('meals-container');
                console.log('✅ Meals tab rendered successfully (FuelIQ compatibility)');
              } catch (error) {
                console.error('Error rendering meals tab (FuelIQ):', error);
              }
            } else {
              retryCount++;
              if (retryCount < maxRetries) {
                console.log(`⏳ Waiting for meals module... (${retryCount}/${maxRetries})`);
                setTimeout(tryRenderMeals, 1000);
              } else {
                console.warn('❌ Meals module failed to load');
                const container = document.getElementById('meals-container');
                if (container) {
                  container.innerHTML = `
                    <div class="max-w-6xl mx-auto p-6">
                      <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                        <h2 class="text-xl font-bold text-blue-800 mb-2">🍽️ Nutrition Tab Issue</h2>
                        <p class="text-blue-600 mb-4">Nutrition functionality is not loading properly.</p>
                        <button onclick="location.reload()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                          Refresh Page
                        </button>
                      </div>
                    </div>
                  `;
                }
              }
            }
          };
          
          setTimeout(tryRenderMeals, 500);
        }
      }, [currentView]);

      useEffect(() => {
        if (currentView === 'profile') {
          clearContainer('profile-container');
          
          let retryCount = 0;
          const maxRetries = 10;
          
          const tryRenderProfile = () => {
            if (window.HabbtProfile && window.HabbtProfile.renderProfileTab) {
              try {
                window.HabbtProfile.renderProfileTab('profile-container');
                console.log('✅ Profile tab rendered successfully (Habbt)');
              } catch (error) {
                console.error('Error rendering profile tab (Habbt):', error);
              }
            } else if (window.FuelIQProfile && window.FuelIQProfile.renderProfileTab) {
              try {
                window.FuelIQProfile.renderProfileTab('profile-container');
                console.log('✅ Profile tab rendered successfully (FuelIQ compatibility)');
              } catch (error) {
                console.error('Error rendering profile tab (FuelIQ):', error);
              }
            } else {
              retryCount++;
              if (retryCount < maxRetries) {
                console.log(`⏳ Waiting for Profile module... (${retryCount}/${maxRetries})`);
                setTimeout(tryRenderProfile, 200);
              } else {
                console.warn('❌ Profile module failed to load');
              }
            }
          };
          
          setTimeout(tryRenderProfile, 100);
        }
      }, [currentView]);

      useEffect(() => {
        if (currentView === 'planning') {
          clearContainer('planning-container');
          
          let retryCount = 0;
          const maxRetries = 10;
          
          const tryRenderPlanning = () => {
            if (window.HabbtMealPlanning && window.HabbtMealPlanning.renderMealPlanning) {
              try {
                window.HabbtMealPlanning.renderMealPlanning('planning-container');
                console.log('✅ Planning tab rendered successfully');
              } catch (error) {
                console.error('Error rendering planning tab:', error);
              }
            } else {
              retryCount++;
              if (retryCount < maxRetries) {
                console.log(`⏳ Waiting for HabbtMealPlanning module... (${retryCount}/${maxRetries})`);
                setTimeout(tryRenderPlanning, 200);
              } else {
                console.warn('❌ HabbtMealPlanning module failed to load');
              }
            }
          };
          
          setTimeout(tryRenderPlanning, 100);
        }
      }, [currentView]);

      // Add other tab rendering useEffects (pantry, grocery, analytics, wearables, journal)
      useEffect(() => {
        if (currentView === 'pantry') {
          clearContainer('pantry-container');
          
          let retryCount = 0;
          const maxRetries = 3;
          
          const tryRenderPantry = () => {
            if (window.HabbtPantry && window.HabbtPantry.renderSmartPantry) {
              try {
                window.HabbtPantry.renderSmartPantry('pantry-container');
                console.log('✅ Pantry tab rendered successfully');
              } catch (error) {
                console.error('Error rendering pantry tab:', error);
              }
            } else {
              retryCount++;
              if (retryCount < maxRetries) {
                setTimeout(tryRenderPantry, 1000);
              }
            }
          };
          
          setTimeout(tryRenderPantry, 500);
        }
      }, [currentView]);

      useEffect(() => {
        if (currentView === 'grocery') {
          clearContainer('grocery-container');
          
          let retryCount = 0;
          const maxRetries = 10;
          
          const tryRenderGrocery = () => {
            if (window.HabbtGroceryDelivery && window.HabbtGroceryDelivery.renderGroceryDelivery) {
              try {
                window.HabbtGroceryDelivery.renderGroceryDelivery('grocery-container');
                console.log('✅ Grocery tab rendered successfully');
              } catch (error) {
                console.error('Error rendering grocery tab:', error);
              }
            } else {
              retryCount++;
              if (retryCount < maxRetries) {
                setTimeout(tryRenderGrocery, 200);
              }
            }
          };
          
          setTimeout(tryRenderGrocery, 100);
        }
      }, [currentView]);

      useEffect(() => {
        if (currentView === 'analytics') {
          clearContainer('analytics-container');
          
          let retryCount = 0;
          const maxRetries = 10;
          
          const tryRenderAnalytics = () => {
            if (window.HabbtAnalytics && window.HabbtAnalytics.renderAnalyticsTab) {
              try {
                window.HabbtAnalytics.renderAnalyticsTab('analytics-container');
                console.log('✅ Analytics tab rendered successfully');
              } catch (error) {
                console.error('Error rendering analytics tab:', error);
              }
            } else {
              retryCount++;
              if (retryCount < maxRetries) {
                setTimeout(tryRenderAnalytics, 200);
              }
            }
          };
          
          setTimeout(tryRenderAnalytics, 100);
        }
      }, [currentView]);

      useEffect(() => {
        if (currentView === 'wearables') {
          clearContainer('wearables-container');
          
          let retryCount = 0;
          const maxRetries = 10;
          
          const tryRenderWearables = () => {
            if (window.HabbtWearables && window.HabbtWearables.renderWearablesHub) {
              try {
                window.HabbtWearables.renderWearablesHub('wearables-container');
                console.log('✅ Wearables tab rendered successfully');
              } catch (error) {
                console.error('Error rendering wearables tab:', error);
              }
            } else {
              retryCount++;
              if (retryCount < maxRetries) {
                setTimeout(tryRenderWearables, 200);
              }
            }
          };
          
          setTimeout(tryRenderWearables, 100);
        }
      }, [currentView]);

      useEffect(() => {
        if (currentView === 'journal') {
          clearContainer('journal-container');
          
          let retryCount = 0;
          const maxRetries = 10;
          
          const tryRenderJournal = () => {
            if (window.HabbtJournal && window.HabbtJournal.renderJournalTab) {
              try {
                window.HabbtJournal.renderJournalTab('journal-container');
                console.log('✅ Journal tab rendered successfully');
              } catch (error) {
                console.error('Error rendering journal tab:', error);
              }
            } else {
              retryCount++;
              if (retryCount < maxRetries) {
                setTimeout(tryRenderJournal, 200);
              }
            }
          };
          
          setTimeout(tryRenderJournal, 100);
        }
      }, [currentView]);

      // Navigation event listener
      useEffect(() => {
        const handleNavigation = (event) => {
          forceCleanup();
          setTimeout(() => {
            setCurrentView(event.detail);
          }, 100);
        };
        
        window.addEventListener('navigateToTab', handleNavigation);
        
        return () => {
          window.removeEventListener('navigateToTab', handleNavigation);
          forceCleanup();
        };
      }, []);

      // Calculate current nutrition totals
      const totals = useMemo(() => {
        const today = new Date().toISOString().split('T')[0];
        const key = `habbt_meals_${today}`;
        try {
          const data = JSON.parse(localStorage.getItem(key) || '{}');
          const allFoods = [...(data.breakfast||[]), ...(data.lunch||[]), ...(data.dinner||[]), ...(data.snacks||[])];
          return allFoods.reduce((acc, item) => {
            const mult = (item.servingSize || 100) / 100;
            return {
              calories: acc.calories + ((item.calories || 0) * mult),
              protein: acc.protein + ((item.protein || 0) * mult),
              carbs: acc.carbs + ((item.carbs || 0) * mult),
              fat: acc.fat + ((item.fat || 0) * mult),
              fiber: acc.fiber + ((item.fiber || 0) * mult)
            };
          }, { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0 });
        } catch (e) {
          return { calories: 0, protein: 0, carbs: 0, fat: 0, fiber: 0 };
        }
      }, [currentView]);

      // Navigation component (no sign out needed)
      function Navigation({ userDisplayName }) {
        const [isNavigating, setIsNavigating] = useState(false);
        
        const handleNavClick = (targetView) => {
          if (isNavigating) return;
          
          setIsNavigating(true);
          
          if (targetView === 'dashboard') {
            const profileContainer = document.getElementById('profile-container');
            if (profileContainer) {
              profileContainer.innerHTML = '';
            }
          }
          
          forceCleanup();
          
          setTimeout(() => {
            setCurrentView(targetView);
            setIsNavigating(false);
            console.log(`✅ Navigated to: ${targetView}`);
          }, 100);
        };
        
        return e('div', { className: "bg-gradient-blue-teal shadow-xl" },
          e('div', { className: "max-w-7xl mx-auto px-6" },
            e('div', { className: "flex items-center justify-between py-4" },
              e('div', { className: "flex items-center space-x-4" },
                e('div', { className: "flex items-center space-x-2" },
                  e('div', { className: "w-10 h-10 bg-white rounded-xl flex items-center justify-center" },
                    e('span', { className: "text-2xl text-blue-600" }, '⚡')
                  ),
                  e('h1', { 
                    className: "text-2xl font-bold text-white tracking-tight", 
                    style: {fontFamily: 'Georgia, Times, serif'} 
                  }, "Habbt"),
                  e('span', { className: "text-blue-100 text-sm hidden md:inline" }, 
                    userDisplayName ? `Welcome, ${userDisplayName}!` : `Welcome!`
                  )
                )
              ),
              
              e('div', { className: "flex items-center space-x-4" },
                // Navigation tabs
                e('div', { className: "flex space-x-1 bg-white/10 rounded-2xl p-1 overflow-x-auto backdrop-blur-sm" },
                 [
                    { id: 'profile', label: 'Profile', icon: '👤' },
                    { id: 'dashboard', label: 'Dashboard', icon: '📊', highlight: true },
                    { id: 'meals', label: 'Nutrition', icon: '🍽️' },
                    { id: 'pantry', label: 'Pantry', icon: '🛒' },
                    { id: 'planning', label: 'Planning', icon: '📅' },
                    { id: 'grocery', label: 'Delivery', icon: '🚚' },
                    { id: 'wearables', label: 'Devices', icon: '⌚' },
                    { id: 'analytics', label: 'Analytics', icon: '📈' },
                    { id: 'journal', label: 'Journal', icon: '📝' }
                  ].map(({ id, label, icon }) => 
                    e('button', {
                      key: id,
                      onClick: () => handleNavClick(id),
                      disabled: isNavigating,
                      className: `flex items-center space-x-2 px-4 py-2 rounded-xl font-medium text-sm whitespace-nowrap transition-all duration-200 ${
        currentView === id
          ? (id === 'dashboard' ? 'bg-teal-500 text-white shadow-lg' : 'bg-white text-blue-600 shadow-lg')
          : 'text-white/80 hover:text-white hover:bg-white/10'
      } ${isNavigating ? 'opacity-50 cursor-not-allowed' : ''}`
                    },
                      e('span', { className: "text-lg" }, icon),
                      e('span', { className: "hidden md:inline" }, label)
                    )
                  )
                )
              )
            )
          )
        );
      }

      // Special handling for profile tab
      if (currentView === 'profile') {
        return e('div', { className: "min-h-screen bg-gradient-card" },
          e(Navigation, { userDisplayName }),
          e('div', { id: "profile-container", className: "profile-tab-content" })
        );
      }

    // Dashboard view (enhanced with wearables data)
if (currentView === 'dashboard') {
  const now = new Date();
  const today = now.toLocaleDateString('en-US', { 
    weekday: 'long', 
    year: 'numeric', 
    month: 'long', 
    day: 'numeric' 
  });
  
  const currentTime = now.toLocaleTimeString('en-US', {
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  });

  // Get goals from profile data
  const profileGoals = (() => {
    try {
      const profileData = localStorage.getItem('habbt_profile_data');
      if (profileData) {
        const parsed = JSON.parse(profileData);
        if (parsed.goals) {
          return {
            calories: parsed.goals.calories || 2000,
            protein: parsed.goals.protein || 150,
            carbs: parsed.goals.carbs || 250,
            fat: parsed.goals.fat || 67,
            water: parsed.goals.water || 64
          };
        }
      }
    } catch (e) {
      console.warn('Error loading goals:', e);
    }
    
    return { calories: 2000, protein: 150, carbs: 250, fat: 67, water: 64 };
  })();

  // Load wearables data
  const getWearablesData = () => {
    try {
      const healthData = localStorage.getItem('habbt_dashboard_health_data');
      return healthData ? JSON.parse(healthData) : null;
    } catch (error) {
      return null;
    }
  };

  const wearablesData = getWearablesData();
  const hasWearables = wearablesData && wearablesData.dailyMetrics;

  // Get movement data
  const steps = hasWearables ? (wearablesData.dailyMetrics.steps || 0) : 0;
  const movementText = hasWearables ? 
    (steps < 5000 ? 'Gentle movement helps circulation' : 
     steps < 8000 ? 'Good activity supports your goals' :
     steps < 12000 ? 'Great activity! Focus on recovery' :
     'Outstanding! Prioritize hydration') : 'Connect device to track';

  // Get sleep data
  const sleepHours = hasWearables && wearablesData.dailyMetrics.sleep ? 
    (wearablesData.dailyMetrics.sleep.totalSleep / 60).toFixed(1) : 0;
  const sleepText = hasWearables ?
    (sleepHours >= 8 ? 'Excellent rest supports nutrition goals' :
     sleepHours >= 7 ? 'Good sleep helps food choices' :
     sleepHours >= 6 ? 'Try magnesium-rich foods tonight' :
     'Poor sleep affects hunger hormones') : 'Connect device to track';

  const getProgressPercentage = (current, goal) => {
    const currentNum = parseFloat(current) || 0;
    const goalNum = parseFloat(goal) || 1;
    return Math.min((currentNum / goalNum) * 100, 100);
  };

  return e('div', { className: "min-h-screen bg-gradient-card" },
    e(Navigation, { userDisplayName }),
    e('div', { className: "max-w-7xl mx-auto p-6" },
      
      // Welcome Header
      e('div', { className: "bg-gradient-to-r from-blue-600 via-blue-700 to-teal-600 rounded-3xl shadow-2xl p-8 mb-8 text-white relative overflow-hidden" },
        e('div', { className: "text-center relative z-10" },
          e('div', { className: "w-20 h-20 bg-white/20 rounded-2xl flex items-center justify-center mx-auto mb-4 backdrop-blur-sm" },
            e('span', { className: "text-4xl" }, '📊')
          ),
          e('h1', { 
            className: "text-5xl font-bold mb-3", 
            style: {fontFamily: 'Georgia, Times, serif'} 
          }, 'Mission Control'),
          e('p', { className: "text-xl opacity-90 mb-2" }, today),
          e('p', { className: "text-lg font-semibold opacity-95" }, currentTime),
          e('div', { className: "mt-4 text-sm opacity-80" }, 
            hasWearables ? 
              `🎯 Health data connected • ${wearablesData.connectedDevices || 0} devices` :
              '🎯 Local nutrition tracking - no cloud required'
          )
        )
      ),

      // Main Metrics Grid
      e('div', { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" },
        
        // Nutrition Card (unchanged)
        e('div', { 
          className: "bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 p-6 cursor-pointer hover:scale-105 transition-all duration-200 group",
          onClick: () => setCurrentView('meals')
        },
          e('div', { className: 'flex items-center justify-between mb-4' },
            e('div', { className: 'flex items-center space-x-3' },
              e('div', { className: 'text-3xl p-3 bg-gradient-to-r from-blue-100 to-teal-100 rounded-2xl group-hover:scale-110 transition-transform duration-200' }, '🍽️'),
              e('div', null,
                e('h3', { className: 'text-lg font-bold text-gray-800' }, 'Nutrition'),
                e('p', { className: 'text-xs text-gray-600' }, 'Daily nutrition tracking')
              )
            ),
            e('div', { className: 'text-sm font-bold bg-gradient-to-r from-blue-500 to-teal-500 bg-clip-text text-transparent' }, 
              Math.round(getProgressPercentage(totals.calories, profileGoals.calories)) + '%'
            )
          ),
          e('div', { className: 'mb-4' },
            e('div', { className: 'flex items-baseline space-x-2' },
              e('span', { className: 'text-3xl font-bold text-gray-900' }, Math.round(totals.calories || 0)),
              e('span', { className: 'text-lg text-gray-600' }, 'kcal'),
              e('span', { className: 'text-gray-400' }, '/'),
              e('span', { className: 'text-lg text-gray-600' }, `${profileGoals.calories} kcal`)
            )
          ),
          e('div', { className: 'w-full bg-gray-200 rounded-full h-3' },
            e('div', {
              className: 'bg-gradient-to-r from-blue-500 to-teal-500 h-3 rounded-full transition-all duration-500',
              style: { width: `${getProgressPercentage(totals.calories, profileGoals.calories)}%` }
            })
          )
        ),
        
        // Enhanced Movement Card
        e('div', { 
          className: "bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 p-6 cursor-pointer hover:scale-105 transition-all duration-200 group",
          onClick: () => setCurrentView('wearables')
        },
          e('div', { className: 'flex items-center justify-between mb-4' },
            e('div', { className: 'flex items-center space-x-3' },
              e('div', { className: 'text-3xl p-3 bg-gradient-to-r from-green-100 to-emerald-100 rounded-2xl group-hover:scale-110 transition-transform duration-200' }, '👟'),
              e('div', null,
                e('h3', { className: 'text-lg font-bold text-gray-800' }, 'Movement'),
                e('p', { className: 'text-xs text-gray-600' }, hasWearables ? 'Device connected' : 'Connect device')
              )
            ),
            e('div', { className: 'text-sm font-bold text-green-600' }, 
              hasWearables ? (steps < 5000 ? '🚶' : steps < 8000 ? '🏃' : steps < 12000 ? '💪' : '🔥') : '📱'
            )
          ),
          e('div', { className: 'mb-4' },
            e('div', { className: 'flex items-baseline space-x-2' },
              e('span', { className: 'text-3xl font-bold text-gray-900' }, steps.toLocaleString()),
              e('span', { className: 'text-lg text-gray-600' }, 'steps'),
              hasWearables && e('span', { className: 'text-gray-400' }, '/'),
              hasWearables && e('span', { className: 'text-lg text-gray-600' }, '10,000')
            )
          ),
          hasWearables ? (
            e('div', { className: 'w-full bg-gray-200 rounded-full h-3 mb-3' },
              e('div', {
                className: 'bg-gradient-to-r from-green-500 to-emerald-500 h-3 rounded-full transition-all duration-500',
                style: { width: `${Math.min((steps / 10000) * 100, 100)}%` }
              })
            )
          ) : (
            e('div', { className: 'mb-3' },
              e('button', { 
                className: 'w-full py-2 px-3 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg text-sm font-medium hover:from-green-600 hover:to-emerald-700 transition-all'
              }, '📱 Connect Device')
            )
          ),
          e('div', { className: 'text-xs text-blue-600 bg-blue-50 p-2 rounded-lg' },
            `💡 ${movementText}`
          )
        ),
        
        // Enhanced Rest Card
        e('div', { 
          className: "bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 p-6 cursor-pointer hover:scale-105 transition-all duration-200 group",
          onClick: () => setCurrentView('wearables')
        },
          e('div', { className: 'flex items-center justify-between mb-4' },
            e('div', { className: 'flex items-center space-x-3' },
              e('div', { className: 'text-3xl p-3 bg-gradient-to-r from-purple-100 to-indigo-100 rounded-2xl group-hover:scale-110 transition-transform duration-200' }, '😴'),
              e('div', null,
                e('h3', { className: 'text-lg font-bold text-gray-800' }, 'Rest'),
                e('p', { className: 'text-xs text-gray-600' }, hasWearables ? 'Sleep tracked' : 'Connect device')
              )
            ),
            e('div', { className: 'text-sm font-bold text-purple-600' }, 
              hasWearables ? (sleepHours >= 8 ? '😴' : sleepHours >= 7 ? '😊' : sleepHours >= 6 ? '😐' : '😵') : '📱'
            )
          ),
          e('div', { className: 'mb-4' },
            e('div', { className: 'flex items-baseline space-x-2' },
              e('span', { className: 'text-3xl font-bold text-gray-900' }, sleepHours),
              e('span', { className: 'text-lg text-gray-600' }, 'hrs'),
              hasWearables && e('span', { className: 'text-gray-400' }, '/'),
              hasWearables && e('span', { className: 'text-lg text-gray-600' }, '8 hrs')
            )
          ),
          hasWearables ? (
            e('div', { className: 'w-full bg-gray-200 rounded-full h-3 mb-3' },
              e('div', {
                className: 'bg-gradient-to-r from-purple-500 to-indigo-500 h-3 rounded-full transition-all duration-500',
                style: { width: `${Math.min((sleepHours / 8) * 100, 100)}%` }
              })
            )
          ) : (
            e('div', { className: 'mb-3' },
              e('button', { 
                className: 'w-full py-2 px-3 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg text-sm font-medium hover:from-purple-600 hover:to-indigo-700 transition-all'
              }, '📱 Connect Device')
            )
          ),
          e('div', { className: 'text-xs text-blue-600 bg-blue-50 p-2 rounded-lg' },
            `💡 ${sleepText}`
          )
        ),
        
        // Hydration Card (unchanged)
        e('div', { className: "bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl border border-white/20 p-6 opacity-90" },
          e('div', { className: 'flex items-center justify-between mb-4' },
            e('div', { className: 'flex items-center space-x-3' },
              e('div', { className: 'text-3xl p-3 bg-gradient-to-r from-cyan-100 to-blue-100 rounded-2xl' }, '💧'),
              e('div', null,
                e('h3', { className: 'text-lg font-bold text-gray-800' }, 'Hydration'),
                e('p', { className: 'text-xs text-gray-600' }, 'Manual tracking')
              )
            ),
            e('div', { className: 'text-sm font-bold text-cyan-600' }, '🚰')
          ),
          e('div', { className: 'mb-4' },
            e('div', { className: 'flex items-baseline space-x-2' },
              e('span', { className: 'text-3xl font-bold text-gray-900' }, '0'),
              e('span', { className: 'text-lg text-gray-600' }, 'oz'),
              e('span', { className: 'text-gray-400' }, '/'),
              e('span', { className: 'text-lg text-gray-600' }, `${profileGoals.water} oz`)
            )
          ),
          e('div', { className: 'mb-3' },
            e('button', { 
              className: 'w-full py-2 px-3 bg-gradient-to-r from-cyan-500 to-blue-600 text-white rounded-lg text-sm font-medium hover:from-cyan-600 hover:to-blue-700 transition-all'
            }, '+ Add Water')
          ),
          e('div', { className: 'text-xs text-blue-600 bg-blue-50 p-2 rounded-lg' },
            '💡 Proper hydration supports nutrient absorption'
          )
        )
      ),

      // Status section
      e('div', { className: "bg-green-50 border border-green-200 rounded-xl p-4" },
        e('div', { className: "flex items-center justify-between" },
          e('div', { className: "flex items-center space-x-3" },
            e('span', { className: "text-2xl" }, '💾'),
            e('div', {},
              e('h3', { className: "font-bold text-green-800" }, 'Habbt Local Mode Active'),
              e('p', { className: "text-sm text-green-600" }, 
                hasWearables ? 
                  'Health data syncing - wearables connected' :
                  'Your data is stored securely on your device - no cloud required'
              )
            )
          ),
          e('div', { className: "text-right" },
            e('div', { className: "text-green-600 text-sm font-medium" }, 
              userDisplayName ? `${userDisplayName}` : 'User'
            ),
            e('div', { className: "text-xs text-green-500" }, 
              hasWearables ? '📊 Live Health Data' : '📱 Local Storage Only'
            )
          )
        )
      )
    )
  );
}

      // All other view handlers
      if (currentView === 'meals') {
        return e('div', { className: "min-h-screen bg-gradient-card" },
          e(Navigation, { userDisplayName }),
          e('div', { id: "meals-container", className: "meals-tab-content" })
        );
      }

      if (currentView === 'pantry') {
        return e('div', { className: "min-h-screen bg-gradient-card" },
          e(Navigation, { userDisplayName }),
          e('div', { id: "pantry-container", className: "pantry-tab-content" })
        );
      }

      if (currentView === 'planning') {
        return e('div', { className: "min-h-screen bg-gradient-card" },
          e(Navigation, { userDisplayName }),
          e('div', { id: "planning-container", className: "planning-tab-content" })
        );
      }

      if (currentView === 'grocery') {
        return e('div', { className: "min-h-screen bg-gradient-card" },
          e(Navigation, { userDisplayName }),
          e('div', { id: "grocery-container", className: "grocery-tab-content" })
        );
      }

      if (currentView === 'analytics') {
        return e('div', { className: "min-h-screen bg-gradient-card" },
          e(Navigation, { userDisplayName }),
          e('div', { id: "analytics-container", className: "analytics-tab-content" })
        );
      }

      if (currentView === 'wearables') {
        return e('div', { className: "min-h-screen bg-gradient-card" },
          e(Navigation, { userDisplayName }),
          e('div', { id: "wearables-container", className: "wearables-tab-content" })
        );
      }

      if (currentView === 'journal') {
        return e('div', { className: "min-h-screen bg-gradient-card" },
          e(Navigation, { userDisplayName }),
          e('div', { id: "journal-container", className: "journal-tab-content" })
        );
      }

      // Default view for other sections
      return e('div', { className: "min-h-screen bg-gradient-card" },
        e(Navigation, { userDisplayName }),
        e('div', { className: "max-w-6xl mx-auto p-6" },
          e('div', { className: "bg-white/80 backdrop-blur-sm rounded-3xl shadow-2xl p-8 border border-white/20 text-center" },
            e('div', { className: "w-20 h-20 bg-gradient-to-br from-blue-600 to-teal-600 rounded-2xl flex items-center justify-center mx-auto mb-6" },
              e('span', { className: "text-4xl text-white" }, '⚡')
            ),
            e('h2', { className: "text-3xl font-bold mb-4 text-gradient" },
              {
                'profile': 'Profile',
                'meals': 'Nutrition Habits',
                'pantry': 'Smart Pantry',
                'planning': 'Habit Planning',
                'grocery': 'Grocery Delivery',
                'wearables': 'Connected Devices',
                'analytics': 'Progress Analytics'
              }[currentView] || 'Feature Coming Soon'
            ),
            e('p', { className: "text-xl text-gray-600 mb-8" }, "This habit is coming soon to your system for better!"),
            e('button', {
              onClick: () => setCurrentView('dashboard'),
              className: "px-8 py-4 bg-gradient-to-r from-blue-600 to-teal-600 text-white rounded-2xl hover:from-blue-700 hover:to-teal-700 font-bold text-lg shadow-xl transform hover:scale-105 transition-all duration-200"
            }, "Back to Dashboard")
          )
        )
      );
    }

    // Render the app (no authentication required)
    ReactDOM.render(e(HabbtApp), document.getElementById('root'));
  </script>
</body>
</html>
